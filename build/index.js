"use strict";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,s){for(var t=0;t<s.length;t++){var i=s[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(s,t,i){return t&&e(s.prototype,t),i&&e(s,i),s}}();window.addEventListener("load",function(){var e={w:$(window),d:$(document),popupForm:$(document.querySelector(".js-confirm")),btnStart:$(document.querySelector(".js-start"))},s=function(){function e(s){_classCallCheck(this,e),this.form=s,this.input=s.find(".js-confirm-input"),this.errorClass="is-error"}return _createClass(e,[{key:"init",value:function(){var e=this;this.input.focus(function(){e.input.removeClass(e.errorClass)})}},{key:"validate",value:function(){return""===this.input.val()?(this.input.addClass(this.errorClass),!1):(this.input.removeClass(this.errorClass),!0)}},{key:"name",get:function(){return""!==this.input.val()?this.input.val():void console.error("Имя не введено!")}}]),e}(),t=new s(e.popupForm);t.init();var i=function(){function e(){_classCallCheck(this,e),this.sizeField=9,this.flotilla=[{size:1,direct:"g",pos:[]},{size:1,direct:"g",pos:[]},{size:2,direct:"g",pos:[]},{size:2,direct:"v",pos:[]},{size:3,direct:"g",pos:[]},{size:3,direct:"v",pos:[]},{size:4,direct:"g",pos:[]},{size:4,direct:"v",pos:[]}],this.flotilla2=[{size:1,direct:"g",pos:[]},{size:1,direct:"g",pos:[]},{size:2,direct:"g",pos:[]},{size:2,direct:"v",pos:[]},{size:3,direct:"g",pos:[]},{size:3,direct:"v",pos:[]},{size:4,direct:"g",pos:[]},{size:4,direct:"v",pos:[]}],this.userNameField=$(document.querySelector(".js-user-name")),this.battleField=$(".js-battle-field"),this.fieldUser=$(document.querySelector(".js-battle-field-user")),this.fieldComp=$(document.querySelector(".js-battle-field-computer")),this.output=$(document.querySelector(".js-msg-game")),this.walk=!0}return _createClass(e,[{key:"generateShip",value:function(e,s){var t=this,i=[],a=0,r=0,l="";"g"===e.direct?(r=t.randomNum(0,t.sizeField-e.size+1),a=t.randomNum(0,t.sizeField)):(a=t.randomNum(0,t.sizeField-e.size+1),r=t.randomNum(0,t.sizeField));for(var n=0;n<e.size;n++)l="g"===e.direct?String(a)+(r+n):String(a+n)+r,i.push(l);return i}},{key:"drawCell",value:function(e,s,t,i){var a=e.find(".js-game-cell[data-coord="+s+"]");a.addClass("is-ship").html(),"g"===t?a.addClass("is-g"):a.addClass("is-v"),"start"===i&&a.addClass("is-start"),"end"===i&&a.addClass("is-end"),"one"===i&&a.addClass("is-one")}},{key:"drawShip",value:function(e,s){var t=this,i=e.direct;$.each(e.pos,function(a){var r=void 0;1===e.pos.length?r="one":(0===a&&(r="start"),a===e.pos.length-1&&(r="end")),t.drawCell(s,this,i,r)})}},{key:"generateFlotilla",value:function(e,s){var t=this;$.each(s,function(i){var a=void 0;do a=t.generateShip(this,e);while(t.crossing(a,s));s[i].pos=a})}},{key:"crossing",value:function(e,s){for(var t=0;t<s.length;t++)for(var i=s[t],a=0;a<e.length;a++)if(i.pos.indexOf(e[a])>=0)return!0;return!1}},{key:"msg",value:function(e){this.output.text(e)}},{key:"setUserName",value:function(e){this.userNameField.text(e)}},{key:"randomEl",value:function(e){return e[Math.floor(Math.random()*e.length)]}},{key:"randomNum",value:function(e,s){return e+Math.floor(Math.random()*(s+1-e))}},{key:"generateRow",value:function(e){return'<div class="c-game__row">'+e+"</div>"}},{key:"generateCell",value:function(e){for(var s="",t=0;t<10;t++)s+='<div class="c-game__cell js-game-cell" data-coord="'+e+t+'"></div>';return s}},{key:"userTurn",value:function(e){var s=this;if(!this.walk)return!1;e.hasClass("is-ship")?(e.addClass("is-damage").removeClass("js-game-cell"),this.msg("Ваш ход"),this.walk=!0):(e.addClass("is-error").removeClass("js-game-cell"),this.msg("Компьютер ходит"),this.walk=!1,setTimeout(function(){s.compTurn()},1e3));var t=this.fieldComp.find(".is-ship").length,i=this.fieldComp.find(".is-damage").length;return i>=t?(this.msg("Вы выиграли! Новая игра?"),this.output.addClass("is-success"),this.walk=!1,!1):void 0}},{key:"compTurn",value:function(){var e=this.fieldUser.find(".is-ship").length,s=this.fieldUser.find(".is-damage").length;if(s>=e)return this.msg("Вы проиграли! Новая игра?"),this.output.addClass("is-error"),this.walk=!1,!1;var t=$(this.randomEl(this.fieldUser.find(".js-game-cell").toArray()));t.hasClass("is-ship")?(t.addClass("is-damage"),this.msg("Компьютер ходит"),t.removeClass("js-game-cell").addClass("is-damage"),this.compTurn()):(t.removeClass("js-game-cell"),this.msg("Ваш ход"),t.addClass("is-error"),this.walk=!0)}},{key:"init",value:function(){var e=this;e.output.removeClass("is-error is-success");for(var s="",t=0;t<10;t++)s+=this.generateRow(this.generateCell(t));e.battleField.html(s),e.generateFlotilla(e.fieldUser,e.flotilla),e.generateFlotilla(e.fieldComp,e.flotilla2),$.each(e.flotilla,function(){e.drawShip(this,e.fieldUser)}),$.each(e.flotilla2,function(){e.drawShip(this,e.fieldComp)}),this.walk=!0}}]),e}(),a=new i;e.w.click(function(s){var t=$(s.target);t.hasClass("js-start")&&e.popupForm.fadeIn(),t.hasClass("js-reload-game")&&(a.init(),a.msg("Ваш ход")),t.hasClass("js-confirm-close")&&e.popupForm.fadeOut()}),e.d.submit(function(s){var i=$(s.target);i.hasClass("js-confirm")&&(s.preventDefault(),t.validate()&&(e.popupForm.fadeOut(),e.btnStart.removeClass("js-start").addClass("is-started  js-reload-game"),a.init(),a.setUserName(t.name),a.msg("Ваш ход")))}),$(".js-battle-field-computer").click(function(e){var s=$(e.target);s.hasClass("js-game-cell")&&a.userTurn(s)})});